!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueSocialauth=e()}(this,function(){"use strict";function a(t){return"function"==typeof t}function s(e,o){return null==e||null==o||Object.keys(o).forEach(function(t){"[object Object]"!=Object.prototype.toString.call(o[t])||"[object Object]"!=Object.prototype.toString.call(e[t])?e[t]=o[t]:e[t]=s(e[t],o[t])}),e}function i(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;e=[t,e].join("/");return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function u(t){var e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function c(t){var e,o,n={};return(t||"").split("&").forEach(function(t){t&&(o=t.split("="),e=decodeURIComponent(o[0]),n[e]=!o[1]||decodeURIComponent(o[1]))}),n}function o(t,e,o){return[encodeURIComponent(t),"=",encodeURIComponent(e),(t=(n=o).path,e=n.domain,o=n.expires,n=n.secure,[null==t?"":";path="+t,null==e?"":";domain="+e,null==o?"":";expires="+o.toUTCString(),null==n||!1===n?"":";secure"].join(""))].join("");var n}function n(){}function l(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],g(t,this)}function r(o,n){for(;3===o._state;)o=o._value;if(0===o._state)return o._deferreds.push(n),0;o._handled=!0,l._immediateFn(function(){var t,e=1===o._state?n.onFulfilled:n.onRejected;if(null!==e){try{t=e(o._value)}catch(t){return void h(n.promise,t)}p(n.promise,t)}else(1===o._state?p:h)(n.promise,o._value)})}function p(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if(e instanceof l)return t._state=3,t._value=e,void d(t);if("function"==typeof o)return void g((n=o,i=e,function(){n.apply(i,arguments)}),t)}t._state=1,t._value=e,d(t)}catch(e){h(t,e)}var n,i}function h(t,e){t._state=2,t._value=e,d(t)}function d(t){2===t._state&&0===t._deferreds.length&&l._immediateFn(function(){t._handled||l._unhandledRejectionFn(t._value)});for(var e=0,o=t._deferreds.length;e<o;e++)r(t,t._deferreds[e]);t._deferreds=null}function f(t,e,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=o}function g(t,e){var o=!1;try{t(function(t){o||(o=!0,p(e,t))},function(t){o||(o=!0,h(e,t))})}catch(t){if(o)return;o=!0,h(e,t)}}function m(t,e){var o,n;m.installed||(m.installed=!0,o=e.property||"$auth",n=null,Object.defineProperties(t.prototype,((t={})[o]={get:function(){if(!n)if(this.$axios)n=new O(this.$axios,e);else{if(!this.$http)throw new Error("Request handler instance not found");n=new O(this.$http,e)}return n}},t)))}"function"!=typeof Object.assign&&(Object.assign=function(t,e){var o=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var r=o[i];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n});var e=setTimeout;l.prototype.catch=function(t){return this.then(null,t)},l.prototype.then=function(t,e){var o=new this.constructor(n);return r(this,new f(t,e,o)),o},l.all=function(t){var p=Array.prototype.slice.call(t);return new l(function(i,r){if(0===p.length)return i([]);for(var a=p.length,t=0;t<p.length;t++)!function e(o,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return n.call(t,function(t){e(o,t)},r),0}p[o]=t,0==--a&&i(p)}catch(t){r(t)}}(t,p[t])})},l.resolve=function(e){return e&&"object"==typeof e&&e.constructor===l?e:new l(function(t){t(e)})},l.reject=function(o){return new l(function(t,e){e(o)})},l.race=function(i){return new l(function(t,e){for(var o=0,n=i.length;o<n;o++)i[o].then(t,e)})},l._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},l._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},l._setImmediateFn=function(t){l._immediateFn=t},l._setUnhandledRejectionFn=function(t){l._unhandledRejectionFn=t};function y(t){this._defaultOptions=s({domain:window.location.hostname,expires:null,path:"/",secure:!1},t)}var v={baseUrl:null,tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-social-auth",cookieStorage:{domain:window.location.hostname,path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(t){var e=t.options.tokenHeader;t.$http.interceptors.request.use(function(t){return delete t.headers[e],t})},bindResponseInterceptor:function(t){t.$http.interceptors.response.use(function(t){return t})},providers:{apple:{name:"apple",url:"/auth/apple",authorizationEndpoint:"https://appleid.apple.com/auth/authorize",redirectUri:window.location.origin+"/",requiredUrlParams:["scope"],scope:["name","email"],scopeDelimiter:"%20",display:"popup",oauthType:"2.0",popupOptions:{width:460,height:600}},facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:window.location.origin,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin,oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:window.location.origin+"/",optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:window.location.origin,requiredUrlParams:["state","scope"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},vkontakte:{name:"vkontakte",url:"/auth/vkontakte",authorizationEndpoint:"https://oauth.vk.com/authorize",redirectUri:window.location.origin+"/",requiredUrlParams:["scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:window.location.origin,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:window.location.origin,oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:window.location.origin,authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}};y.prototype.setItem=function(t,e){e=o(t,e,s({},this._defaultOptions));this._setCookie(e)},y.prototype.getItem=function(t){var e=function(t){if(0===t.length)return{};var o={},e=new RegExp("\\s*;\\s*");return t.split(e).forEach(function(t){var e=t.split("="),t=e[0],e=e[1],t=decodeURIComponent(t),e=decodeURIComponent(e);o[t]=e}),o}(this._getCookie());return e.hasOwnProperty(t)?e[t]:null},y.prototype.removeItem=function(t){var e=s({},this._defaultOptions),e=o(t,"",s(e,{expires:new Date(0)}));this._setCookie(e)},y.prototype._getCookie=function(){return"undefined"==typeof document||void 0===document.cookie?"":document.cookie},y.prototype._setCookie=function(t){document.cookie=t};function w(t){this.namespace=t||null}w.prototype.setItem=function(t,e){window.localStorage.setItem(this._getStorageKey(t),e)},w.prototype.getItem=function(t){return window.localStorage.getItem(this._getStorageKey(t))},w.prototype.removeItem=function(t){window.localStorage.removeItem(this._getStorageKey(t))},w.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};function _(t){this.namespace=t||null,this._storage={}}_.prototype.setItem=function(t,e){this._storage[this._getStorageKey(t)]=e},_.prototype.getItem=function(t){return this._storage[this._getStorageKey(t)]},_.prototype.removeItem=function(t){delete this._storage[this._getStorageKey(t)]},_.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};function U(t){this.namespace=t||null}U.prototype.setItem=function(t,e){window.sessionStorage.setItem(this._getStorageKey(t),e)},U.prototype.getItem=function(t){return window.sessionStorage.getItem(this._getStorageKey(t))},U.prototype.removeItem=function(t){window.sessionStorage.removeItem(this._getStorageKey(t))},U.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};function b(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o}b.prototype.open=function(t,e){try{return this.popup=window.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),e?l.resolve():this.pooling(t)}catch(t){return l.reject(new Error("OAuth popup error occurred"))}},b.prototype.pooling=function(e){var p=this;return new l(function(n,i){var t=document.createElement("a");t.href=e;var r=u(t),a=setInterval(function(){p.popup&&!p.popup.closed&&void 0!==p.popup.closed||(clearInterval(a),a=null,i(new Error("Auth popup window closed")));try{var t,e,o;u(p.popup.location)===r&&(p.popup.location.search||p.popup.location.hash?(t=c(p.popup.location.search.substring(1).replace(/\/$/,"")),e=c(p.popup.location.hash.substring(1).replace(/[\/$]/,"")),o=s({},t),(o=s(o,e)).error?i(new Error(o.error)):n(o)):i(new Error("OAuth redirect has occurred but no query or hash parameters were found.")),clearInterval(a),a=null,p.popup.close())}catch(t){}},250)})},b.prototype._stringifyOptions=function(){var t,e=[];for(t in this.popupOptions)void 0===this.popupOptions[t]||e.push(t+"="+this.popupOptions[t]);return e.join(",")};function C(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=s({},I),this.providerConfig=s(this.providerConfig,o),this.options=n}var I={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}};C.prototype.init=function(e){var o=this;return this.oauthPopup=new b("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),window&&!window.cordova&&this.oauthPopup.open(this.providerConfig.redirectUri,!0),this.getRequestToken().then(function(t){return o.openPopup(t).then(function(t){return o.exchangeForToken(t,e)})})},C.prototype.getRequestToken=function(){var t={method:"POST"};return t[this.options.requestDataKey]=s({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=i(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)},C.prototype.openPopup=function(t){t=[this.providerConfig.authorizationEndpoint,this.buildQueryString(t[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=t,window&&window.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)},C.prototype.exchangeForToken=function(t,e){e=s({},e),e=s(e,t),t={method:"POST"};return t[this.options.requestDataKey]=e,t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=i(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)},C.prototype.buildQueryString=function(t){var e,o=[];for(e in t){var n=t[e];o.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}return o.join("&")};function k(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=s({},P),this.providerConfig=s(this.providerConfig,o),this.options=n}var P={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}};k.prototype.init=function(n){var i=this,r=this.providerConfig.name+"_state";a(this.providerConfig.state)?this.storage.setItem(r,this.providerConfig.state()):"string"==typeof this.providerConfig.state&&this.storage.setItem(r,this.providerConfig.state);var t=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");return this.oauthPopup=new b(t,this.providerConfig.name,this.providerConfig.popupOptions),new Promise(function(e,o){i.oauthPopup.open(i.providerConfig.redirectUri).then(function(t){return"code"!==i.providerConfig.responseType&&i.providerConfig.url?t.state&&t.state!==i.storage.getItem(r)?o(new Error("State parameter value does not match original OAuth request state value")):void e(i.exchangeForToken(t,n)):e(t)}).catch(function(t){o(t)})})},k.prototype.exchangeForToken=function(t,e){var o,n=s({},e);for(o in P.responseParams)switch(o){case"code":n[o]=t.code;break;case"clientId":n[o]=this.providerConfig.clientId;break;case"redirectUri":n[o]=this.providerConfig.redirectUri;break;default:n[o]=t[o]}return t.state&&(n.state=t.state),e=this.options.baseUrl?i(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(e,n,{withCredentials:this.options.withCredentials})},k.prototype._stringifyRequestParams=function(){var n=this,i=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(function(t){n.providerConfig[t]&&Array.isArray(n.providerConfig[t])&&n.providerConfig[t].forEach(function(t){var e=t.replace(/([\:\-\_]+(.))/g,function(t,e,o,n){return n?o.toUpperCase():o}),o=a(n.providerConfig[t])?n.providerConfig[t]():n.providerConfig[e];"redirect_uri"===t&&!o||("state"===t&&(e=n.providerConfig.name+"_state",o=encodeURIComponent(n.storage.getItem(e))),"scope"===t&&Array.isArray(o)&&(o=o.join(n.providerConfig.scopeDelimiter),n.providerConfig.scopePrefix&&(o=[n.providerConfig.scopePrefix,o].join(n.providerConfig.scopeDelimiter))),i.push([t,o]))})}),i.map(function(t){return t.join("=")}).join("&")};var O=function(t,e){var o=s({},v),n=function(t){switch(t.storageType){case"localStorage":try{return window.localStorage.setItem("testKey","test"),window.localStorage.removeItem("testKey"),new w(t.storageNamespace)}catch(t){}case"sessionStorage":try{return window.sessionStorage.setItem("testKey","test"),window.sessionStorage.removeItem("testKey"),new U(t.storageNamespace)}catch(t){}case"cookieStorage":return new y(t.cookieStorage);case"memoryStorage":default:return new _(t.storageNamespace)}}(o=s(o,e));if(Object.defineProperties(this,{$http:{get:function(){return t}},options:{get:function(){return o}},storage:{get:function(){return n}},tokenName:{get:function(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),!(this.options.bindRequestInterceptor&&a(this.options.bindRequestInterceptor)&&this.options.bindResponseInterceptor&&a(this.options.bindResponseInterceptor)))throw new Error("Both request and response interceptors must be functions");this.options.bindRequestInterceptor.call(this,this),this.options.bindResponseInterceptor.call(this,this)};return O.prototype.getToken=function(){return this.storage.getItem(this.tokenName)},O.prototype.authenticate=function(i,r,t){var a=this;return new l(function(e,o){var t,n=a.options.providers[i];if(!n)return o(new Error("Unknown provider"));switch(n.oauthType){case"1.0":t=new C(a.$http,a.storage,n,a.options);break;case"2.0":t=new k(a.$http,a.storage,n,a.options);break;default:return o(new Error("Invalid OAuth type"))}return t.init(r).then(function(t){return e(t)}).catch(function(t){return o(t)})})},m.factory=function(t,e){return new O(t,e)},m});
